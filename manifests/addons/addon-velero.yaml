apiVersion: addons.cluster.x-k8s.io/v1alpha1
kind: HelmChartProxy
metadata:
  name: velero
spec:
  clusterSelector:
    matchLabels:
      veleroChart: enabled
  #repoURL: https://vmware-tanzu.github.io/helm-charts
  repoURL: https://acornsoft-edgecraft.github.io/edgecraft-caaph/helm-charts
  chartName: velero
  version: 5.0.2
  namespace: velero
  releaseName: velero
  options:
    #   disableHooks: true
    #   skipCRDs: false
    #   subNodes: fasle
    #   disableOpenAPIValidation: false
    #   atomic: true
    waitForJobs: true
    wait: true
    #   timeout: 5m
    install:
      createNamespace: true
    #     includeCRDs: true
    upgrade:
      #     force: false
      #     resetValues: true
      #     reuseValues: false
      #     maxHistory: 10
      cleanupOnFail: true
  #   uninstall:
  #     keepHistory: false
  #     description: ""
  valuesTemplate: |
    image:
      repository: velero/velero
      tag: v1.11.0
      pullPolicy: IfNotPresent
      imagePullSecrets: []
    initContainers:
      - name: velero-velero-plugin-for-aws
        image: velero/velero-plugin-for-aws:v1.6.1
        imagePullPolicy: IfNotPresent
        volumeMounts:
          - mountPath: /target
            name: plugins
    configuration:
      backupStorageLocation:
        - name: default
          provider: aws
          bucket: velero
          # minio private key (base64 encoded)
          caCert: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JR0hBZ0VBTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEJHMHdhd0lCQVFRZ2xvTjZKd1E0dHRObUFnNk4KVFBRUTFUSHFjM3pCbFFybjNoVUlOWjN5clVpaFJBTkNBQVN1RTJKeEM1YUR0QmJPamtWOENrUytRdXdTWFZGVApuSGltTGw1aFhpVkc4cEZyaERTQ2FDSHNvazcrNDdKaDRiMHJqdzVyTG94alViMnJ0ZmFHNkpsZgotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0t
          config:
            region: minio
            s3ForcePathStyle: true
            publicUrl: https://192.168.88.74:9000
            s3Url: https://192.168.88.74:9000
      volumeSnapshotLocation:
        - name: default
          provider: aws
          config:
            region: minio
    credentials: 
      useSecret: true
      name: cloud-credentials
      secretContents:
        cloud: |
          [default]
          aws_access_key_id = minioadmin
          aws_secret_access_key = minioadmin
    backupEnabled: true
    snaphostsEnabled: true
    deployNodeAgent: true
    defaultVolumesToFsBackup: true
